@model IEnumerable<Abacus.Models.UserRecord>

@{
    ViewBag.Title = "Index";
}

<h2>User records</h2>
<div class="modal" id="editor-user_record" tabindex="-1" role="dialog" aria-labelledby="editor-title">
    <div class="modal-dialog" role="document">
        <div class="modal-content" id="editor-content-user_record"></div>
    </div>
</div>

<p>
    @*@Html.ActionLink("Create New", "Create")*@
    <a class="btn editor-user_record" data-id="0" data-toggle="modal" data-target="#editor-user_record">Add HobbyDB User</a>
</p>
<table class="table">
    <tr>

        <th>
            @Html.DisplayNameFor(model => model.HDBUserName)
        </th>
        <th>
            @Html.DisplayNameFor(model => model.FirstName)
        </th>
        <th>
            @Html.DisplayNameFor(model => model.LastName)
        </th>
        <th>
            @Html.DisplayNameFor(model => model.UserType)
        </th>
        <th>
            @Html.DisplayNameFor(model => model.HDBUserId)
        </th>

<th></th>
    </tr>

@foreach (var item in Model) {
    <tr>

        <td>
            @*@Html.DisplayFor(modelItem => item.HDBUserName)*@
            @*@Html.ActionLink(item.HDBUserName, "Edit", new { id = item.Id})*@
            <a class="btn editor-user_record" data-id="@item.Id" data-toggle="modal" data-target="#editor-user_record">@item.HDBUserName</a>
        </td>
        <td>
            @Html.DisplayFor(modelItem => item.FirstName)
        </td>
        <td>
            @Html.DisplayFor(modelItem => item.LastName)
        </td>
        <td>
            @{ 
                string userType = string.Empty;
                if ((item.UserType & Abacus.Models.UserRecord.UserTypes.Buyer) == Abacus.Models.UserRecord.UserTypes.Buyer)
                {
                    userType = "Buyer";
                }
                if ((item.UserType & Abacus.Models.UserRecord.UserTypes.Seller) == Abacus.Models.UserRecord.UserTypes.Seller)
                {
                    if (userType != string.Empty) { userType += ", "; }
                    userType += "Seller";
                }
                @userType
            }
        </td>
        <td>
            @Html.DisplayFor(modelItem => item.HDBUserId)
        </td>
        <td>
            @Html.ActionLink("Edit", "Edit", new { id=item.Id }) |
            @Html.ActionLink("Details", "Details", new { id=item.Id }) |
            @Html.ActionLink("Delete", "Delete", new { id=item.Id })
        </td>
    </tr>
}

</table>
@section scripts
{

    <script type="text/javascript">

        $(function () {
            $('.editor-user_record').click(function () {
                var pid = $(this).attr('data-id');
                var defType = $(this).attr('data-usertype');
                var url = "/Carts/ViewHobbyDBUser?Id=" + pid + "&UserType=" + defType;
                $.ajax({
                    url: url,
                    cache: false,
                    success: function (data) {
                        $('#editor-content-user_record').html(data);
                        $('#editor-user_record').modal('show');
                    }
                });
            });

            $('#editor-user_record').on('shown.bs.modal', function () {
                jQuery.validator.unobtrusive.parse($(this));
            })

            $('#editor-user_record').on('hidden.bs.modal', function () {
                $(this).removeData('bs.modal');
            });
        });

        function success(data, status, xhr) {
            $('#editor-user_record').modal('hide');
        }

        function failure(xhr, status, error) {
            $('#editor-user_record').modal('show');
        }
    </script>
}

