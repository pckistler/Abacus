@model IEnumerable<Abacus.Models.UserRecord>
<script src="@Url.Content("~/Scripts/jquery.unobtrusive-ajax.js")" type="text/javascript"></script>
@{
    ViewBag.Title = "Index";
}

<h2>Buyer / Seller records</h2>
<div class="modal" id="editor-user_record" tabindex="-1" role="dialog" aria-labelledby="editor-title">
    <div class="modal-dialog" role="document">
        <div class="modal-content" id="editor-content-user_record"></div>
    </div>
</div>

<p>
    @*@Html.ActionLink("Create New", "Create")*@
    <a class="btn editor-user_record" data-id="0" data-toggle="modal" data-target="#editor-user_record" data-title="Create Buyer / Seller" data-dlg_target="user_listing" id="AddUser" name="AddUser">Add Buyer / Seller</a>
</p>

<div id="user_listing">
    @Html.Partial("_UserList", Model)
</div>

@section scripts
{

    <script type="text/javascript">

        $(function () {
            $('.editor-user_record').click(function () {
                var pid = $(this).attr('data-id');
                var defType = $(this).attr('data-usertype');
                var id = $(this).attr('id');
                var title = $(this).attr('data-title');
                var target = $(this).attr('data-dlg_target');
                var ctl = "UserRecords";
                var method = "HobbyDBUser";
                var successMethod = "success";
                var failMethod = "failure";
                //var target = if (id[0]=='') ? 
                var url = "/Carts/HobbyDBUserDialog?Id=" + pid +
                    "&UserType=" + defType +
                    "&dlgTitle=" + title +
                    "&dlgTarget=" + target +
                    "&dlgCtrl=" + ctl +
                    "&dlgMethod=" + method +
                    "&dlgSuccess=" + successMethod +
                    "&dlgFailure=" + failMethod +
                    "&dlgTime="+Date.now().toString(); // HACK, This should keep the page from being cached
                $.ajax({
                    url: url,
                    cache: false,
                    success: function (data) {                        
                        $('#editor-content-user_record').html(data);
                        $('#editor-user_record').modal('show');
                    }
                });
            });

            $('#editor-user_record').on('shown.bs.modal', function () {
                jQuery.validator.unobtrusive.parse($(this));
            })

            $('#editor-user_record').on('hidden.bs.modal', function () {
                $(this).removeData('bs.modal');
            });
        });

        function success(data, status, xhr) {            
            $('#editor-user_record').modal('hide');
        }

        function failure(xhr, status, error) {
            $('#editor-user_record').modal('show');
        }
    </script>
}

